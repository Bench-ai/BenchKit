import argparse
from BenchKit.Miscellaneous.Settings import get_config, set_config
from BenchKit.Miscellaneous.BenchKit import write_config_template, set_project, set_settings
from Datasets.ProjectDatasets import main
from BenchKit.Miscellaneous.User import delete_dataset
import shutil


def create_datasets():
    main()


def clear():
    shutil.rmtree("./ProjectDatasets")


def cli():
    parser = argparse.ArgumentParser()

    parser.add_argument("-mm",
                        "--makemigration",
                        action='store_true',
                        required=False)

    parser.add_argument("-c",
                        "--clear",
                        action="store_true")

    args = parser.parse_args()

    if args.clear:
        project_name = get_config()["project"]["name"]
        user_creds = get_config()["user_credentials"]
        datasets = get_config()["datasets"]
        for i in datasets:
            d_id = i["info"]["id"]
            delete_dataset(d_id)

        clear()
        write_config_template()
        set_settings()
        set_config({"user_credentials": user_creds})
        set_project(project_name)

    if args.makemigration:
        create_datasets()


if __name__ == '__main__':
    cli()
